<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, spUtil) {
    /* widget controller */
    var c = this;
    var g_form = $scope.page.g_form;
    c.callApi = function() {
        // Clear previous data
        c.data.apiResponse = null;
        c.data.error = null;

        // Call the server script (accessible via c.server)
        c.server.get({
            action: 'fetch_api_data', // Action to identify the request on the server side
            userID: g_form.getValue('user_id')
        }).then(function(response) {
            // Handle successful response from the server
            c.data.apiResponse = response.data.responseBody;
            c.data.userID = response.data.userID;
            c.data.userName = response.data.userName;
            c.data.userEmail = response.data.userEmail;
            c.data.userTitle = response.data.userTitle;
            console.log("API Response:", c.data.apiResponse);
        }).catch(function(error) {
            // Handle errors
            c.data.error = error.data.error_message || 'An error occurred';
            console.error("Error:", error);
        });
    };
};]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>user_lookup</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>User Lookup</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
    /* server script */
    if (input && input.action === 'fetch_api_data') {
        var userID = input.userID;

        // Replace with your actual REST API endpoint URL
        var apiEndpoint = 'https://dev322934.service-now.com/api/1559020/get_user_details';
        var request = new sn_ws.RESTMessageV2();
        request.setEndpoint(apiEndpoint);
        request.setHttpMethod('GET');
        request.setRequestHeader('Accept', 'application/json');
        request.setRequestHeader('user_id', userID);
        // Optional: Add headers or authentication if needed
        // request.setBasicAuth('username', 'password');
        // request.setRequestHeader('Accept', 'application/json');

        try {
            var response = request.execute();
            var responseBody = response.getBody();
            var httpStatus = response.getStatusCode();

            if (httpStatus === 200) {
                // Parse the JSON response
                //data.responseBody = JSON.parse(responseBody);

                var result1 = JSON.parse(responseBody);
                var x = JSON.parse(result1.result.user);
                data.responseBody = "Received Sys ID : " + x[0].sys_id;
                data.userID = x[0].user_name;
                data.userName = x[0].name;
                data.userEmail = x[0].email;
                data.userTitle = x[0].title;
            } else {
                data.error_message = 'API call failed with status: ' + httpStatus;
            }
        } catch (ex) {
            data.error_message = 'Exception during REST call: ' + ex.getMessage();
        }
    }
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>surya_snow</sys_created_by>
        <sys_created_on>2025-12-30 13:56:20</sys_created_on>
        <sys_id>f4ea2487834a7250a14ac296feaad364</sys_id>
        <sys_mod_count>25</sys_mod_count>
        <sys_name>User Lookup</sys_name>
        <sys_package display_value="Developer Program" source="c976a39d8360ea50e12fb9f6feaad347">c976a39d8360ea50e12fb9f6feaad347</sys_package>
        <sys_policy/>
        <sys_scope display_value="Developer Program">c976a39d8360ea50e12fb9f6feaad347</sys_scope>
        <sys_update_name>sp_widget_f4ea2487834a7250a14ac296feaad364</sys_update_name>
        <sys_updated_by>surya_snow</sys_updated_by>
        <sys_updated_on>2026-01-02 14:18:12</sys_updated_on>
        <template><![CDATA[<!DOCTYPE html>
<html>
   <head>
      <style>
         table, th, td {
         border: 1px solid black; /* Adds borders to the table, headers, and cells */
         border-collapse: collapse; /* Collapses borders into a single line */
         padding: 8px; /* Adds space between content and cell border */
         text-align: left; /* Aligns text to the left */
         }
         table {
         width: 100%; /* Optional: sets the table width */
         }
      </style>
   </head>
   <body>
      <div>
         <button class="btn btn-primary" ng-click="c.callApi()">Get Customer Info</button>
         <!--<div ng-if="c.data.apiResponse">
            <h4>API Response:</h4>
            <pre>{{c.data.apiResponse | json}}</pre>
         </div>
         <div ng-if="c.data.error">
            <h4 class="text-danger">Error:</h4>
            <p>{{c.data.error}}</p>
         </div>-->
      </div>
      <h2>Customer Information</h2>
      <table>
         <thead>
            <tr>
               <th>User ID</th>
               <th>Name</th>
               <th>Email</th>
               <th>Title</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td>{{c.data.userID}}</td>
               <td>{{c.data.userName}}</td>
               <td>{{c.data.userEmail}}</td>
               <td>{{c.data.userTitle}}</td>
            </tr>
         </tbody>
      </table>
   </body>
</html>]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>f4ea2487834a7250a14ac296feaad364</id>
        <sys_created_by>surya_snow</sys_created_by>
        <sys_created_on>2025-12-30 13:56:18</sys_created_on>
        <sys_id>93faa087834a7250a14ac296feaad3e2</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>surya_snow</sys_updated_by>
        <sys_updated_on>2025-12-30 13:56:18</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
